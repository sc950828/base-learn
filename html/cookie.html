<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cookie</title>
  </head>
  <body>
    <div>
      <h3>定义</h3>
      <p>
        HTTP Cookie（也叫 Web Cookie 或浏览器
        Cookie）是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。
        通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。Cookie使基于无状态的
        HTTP 协议记录稳定的状态信息成为了可能。
      </p>
    </div>
    <div>
      <h3>特点</h3>
      <ul>
        <li>
          cookie
          数据始终在同源（协议、主机、端口相同）的http请求中携带（即使不需要），会在浏览器和服务器间来回传递。
        </li>
        <li>cookie数据大小不能超过 4 k。 cookie</li>
        <li>过期时间之前一直有效，即使窗口或浏览器关闭。</li>
        <li>cookie在所有同源窗口中都是共享的。</li>
      </ul>
    </div>
    <div>
      <h3>生存周期</h3>
      <p>Cookie 的有效期可以通过 Expires 和 Max-Age 两个属性来设置。</p>
      <ul>
        <li>如果没有设置过期时间，则就是临时cookie，关闭窗口cookie就消失</li>
        <li>Expires 即过期时间</li>
        <li>Max-Age 用的是一段时间间隔，单位是秒，从浏览器收到报文开始计算</li>
      </ul>
    </div>
    <div>
      <h3>作用域</h3>
      <p>
        关于作用域也有两个属性: Domain 和 path, 给 Cookie
        绑定了域名和路径，在发送请求之前，发现域名或者路径和这两个属性不匹配，那么就不会带上
        Cookie。值得注意的是，对于路径来说，/表示域名下的任意路径都允许使用Cookie
      </p>
    </div>
    <div>
      <h3>安全相关</h3>
      <ul>
        <li>如果带上 Secure，说明只能通过 HTTPS 传输 cookie。</li>
        <li>
          如果 cookie 字段带上 HttpOnly，那么说明只能通过 HTTP协议传输，不能通过
          JS 访问，这也是预防 XSS 攻击的重要手段。
        </li>
      </ul>
    </div>
    <div>
      <h3>SameSite 属性</h3>
      <ul>
        <li>
          在 Strict 模式下，浏览器完全禁止第三方请求携带 Cookie。比如请求
          randy.com 网站只能在 randy.com 域名当中请求才能携带
          Cookie，在其他网站请求都不能。
        </li>
        <li>
          在 Lax 模式，就宽松一点了，但是只能在 get 方法提交表单况或者 a
          标签发送 get 请求的情况下可以携带 Cookie，其他情况均不能。
        </li>
        <li>在 None 模式下，也就是默认模式，请求会自动携带上 Cookie。</li>
      </ul>
    </div>
    <div>
      <h3>Cookie 的缺点</h3>
      <ul>
        <li>容量缺陷。Cookie 的体积上限只有 4KB，只能用来存储少量的信息。</li>
        <li>
          性能缺陷。Cookie 紧跟域名，不管域名下面的某一个地址需不需要这个 Cookie
          ，请求都会携带上完整的Cookie，这样随着请求数的增多，其实会造成巨大的性能浪费的，因为请求携带了很多不必要的内容。但可以通过
          Domain 和 Path 指定作用域来解决。
        </li>
        <li>
          安全缺陷。由于 Cookie
          以纯文本的形式在浏览器和服务器中传递，很容易被非法用户截获，然后进行一系列的篡改，在
          Cookie 的有效期内重新发送给服务器，这是相当危险的。另外，在 HttpOnly
          为 false 的情况下，Cookie 信息能直接通过 JS 脚本来读取。
        </li>
      </ul>
    </div>

    <script>
      document.cookie =
        "username1=randy1; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/";
      document.cookie =
        "username2=randy2; Expires=Thu, 18 Dec 2043 12:00:00 GMT;";
      document.cookie = "username3=randy3; Max-Age=60;";
      // 设置domain域名
      document.cookie = "username4=randy4; Max-Age=600;Domain=127.0.0.1";
      // Secure
      document.cookie = "username5=randy5; Secure=true";
      //HttpOnly
      document.cookie = "username6=randy6; HttpOnly=false";
      document.cookie = "username7=randy7; SameSite=Strict";

      document.write("请求字段: Cookie 响应头: Set-Cookie" + "<br/>");
      document.write("cookie: " + document.cookie);
    </script>
  </body>
</html>
